# FastTopUp — Complete Production Project

> Project lengkap siap jual: frontend (HTML/CSS/JS), backend (Node.js + Express), database (SQLite), integrasi supplier (Digiflazz style), integrasi pembayaran (Xendit / Midtrans placeholders), Dockerfile & docker-compose, admin panel sederhana, instruksi deploy, dan packaging.

---

## Struktur proyek (final)
```
fasttopup/
├─ frontend/
│  ├─ index.html
│  ├─ admin.html
│  ├─ assets/
│  │  ├─ logo.png
│  │  └─ style.css
├─ backend/
│  ├─ package.json
│  ├─ server.js
│  ├─ migrations/
│  │  └─ 001_init.sql
│  ├─ .env.example
│  └─ docker/
│     └─ Dockerfile
├─ docker-compose.yml
├─ README.md
└─ LICENSE
```

---

## A. Frontend — `frontend/index.html`
File frontend sudah terhubung ke backend via `API_BASE` variable (set di baris script). Menggunakan dark theme, animasi ringan, form cek ID, product list, pembayaran.

```html
<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FastTopUp — Top Up Game</title>
<link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <header class="site-header">
    <img src="assets/logo.png" alt="FastTopUp" class="logo">
    <h1>FastTopUp</h1>
    <p>Auto top up — ML | FF | PUBG | Stumble</p>
  </header>

  <main class="container">
    <section class="card">
      <h2>Top Up Sekarang</h2>
      <label>ID Player</label>
      <input id="playerId" placeholder="Masukkan ID Player" />
      <label>Server</label>
      <input id="serverId" placeholder="Masukkan Server" />

      <label>Game</label>
      <select id="game">
        <option value="ml">Mobile Legends</option>
        <option value="ff">Free Fire</option>
        <option value="pubg">PUBG Mobile</option>
        <option value="stumble">Stumble Guys</option>
      </select>

      <label>Nominal</label>
      <select id="product">
        <option value='{"code":"ML_86","label":"86 DM","price":22000}'>86 DM - Rp22.000</option>
        <option value='{"code":"ML_170","label":"170 DM","price":42000}'>170 DM - Rp42.000</option>
        <option value='{"code":"ML_257","label":"257 DM","price":63000}'>257 DM - Rp63.000</option>
        <option value='{"code":"ML_514","label":"514 DM","price":123000}'>514 DM - Rp123.000</option>
      </select>

      <label>Metode Pembayaran</label>
      <select id="payment">
        <option value="qris">QRIS</option>
        <option value="dana">DANA</option>
        <option value="ovo">OVO</option>
        <option value="gopay">GoPay</option>
      </select>

      <button id="btnCheck" class="btn">Cek ID & Lanjut</button>
      <div id="msg" class="msg"></div>
    </section>

    <section class="card">
      <h3>Riwayat Terakhir</h3>
      <div id="recent"></div>
    </section>
  </main>

  <script>
    // Ubah ke URL backend kamu jika dipisah domain
    const API_BASE = (window.API_BASE && window.API_BASE.length) ? window.API_BASE : '';

    async function postJSON(url, body){
      const r = await fetch((API_BASE||'') + url, {
        method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)
      });
      return r.json();
    }

    document.getElementById('btnCheck').onclick = async ()=>{
      const playerId = document.getElementById('playerId').value.trim();
      const serverId = document.getElementById('serverId').value.trim();
      const game = document.getElementById('game').value;
      const product = JSON.parse(document.getElementById('product').value);
      const payment = document.getElementById('payment').value;

      if(!playerId||!serverId){ document.getElementById('msg').innerText='ID & Server wajib diisi'; return }
      document.getElementById('msg').innerText='Memeriksa ID...';
      try{
        const check = await postJSON('/api/check-id',{playerId,serverId,game});
        if(check.ok){
          const conf = confirm(`Konfirmasi:
Player: ${playerId}
Produk: ${product.label}
Harga: Rp${product.price}`);
          if(!conf) { document.getElementById('msg').innerText='Dibatalkan'; return }

          document.getElementById('msg').innerText='Membuat pesanan...';
          const order = await postJSON('/api/order',{
            playerId, serverId, game, productCode: product.code, productLabel: product.label, price: product.price, payment
          });

          if(order.ok){
            document.getElementById('msg').innerText='Order dibuat: '+order.orderId;
            if(order.payUrl) window.open(order.payUrl, '_blank');
            loadRecent();
          } else document.getElementById('msg').innerText='Gagal: '+(order.error||'');
        } else document.getElementById('msg').innerText='ID tidak ditemukan';
      } catch(e){ document.getElementById('msg').innerText='Error: '+e.message }
    }

    async function loadRecent(){
      try{
        const r = await fetch('/api/recent');
        const j = await r.json();
        const el = document.getElementById('recent');
        el.innerHTML = j.rows.map(x=>`<div class=rec><b>${x.product}</b> - ${x.playerId} - ${x.price} - ${x.status}</div>`).join('') || 'Belum ada transaksi';
      }catch(e){ }
    }

    loadRecent();
  </script>
</body>
</html>
```

---

## B. Frontend — `frontend/admin.html` (sederhana)
Admin login + list transaksi (menggunakan token dari `/api/admin/login`).

```html
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin FastTopUp</title><link rel="stylesheet" href="assets/style.css"></head>
<body>
  <main class="container">
    <section class="card">
      <h2>Admin Login</h2>
      <input id="u" placeholder="username" />
      <input id="p" type="password" placeholder="password" />
      <button id="login">Login</button>
      <div id="aMsg"></div>
    </section>

    <section class="card" id="panel" style="display:none;">
      <h2>Transaksi</h2>
      <div id="trx"></div>
    </section>
  </main>

<script>
  document.getElementById('login').onclick = async ()=>{
    const u=document.getElementById('u').value, p=document.getElementById('p').value;
    const r = await fetch('/api/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
    const j = await r.json();
    if(j.token){ localStorage.setItem('token',j.token); document.getElementById('panel').style.display='block'; loadTrx() }
    else document.getElementById('aMsg').innerText='Login gagal';
  }
  async function loadTrx(){
    const t = localStorage.getItem('token');
    const r = await fetch('/api/admin/transactions',{headers:{Authorization:'Bearer '+t}});
    const j = await r.json(); document.getElementById('trx').innerHTML = JSON.stringify(j,null,2);
  }
</script>
</body>
</html>
```

---

## C. Frontend CSS — `frontend/assets/style.css`
```css
:root{--bg:#0f1724;--card:#0b1220;--accent:#4a6cf7}
body{font-family:Inter,Arial;background:var(--bg);color:#e6eef8;margin:0}
.site-header{padding:18px;text-align:center;background:linear-gradient(90deg,var(--accent),#6c4af7)}
.logo{width:56px;height:56px;border-radius:10px}
.container{max-width:980px;margin:28px auto;padding:20px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,.6);margin-bottom:14px}
input,select,button{width:100%;padding:12px;border-radius:8px;border:0;margin-top:10px}
.btn{background:linear-gradient(90deg,var(--accent),#6c4af7);color:#fff}
.msg{margin-top:10px;color:#9fb3ff}
.rec{padding:8px;border-bottom:1px solid #16202a}
```

---

## D. Backend — `backend/package.json`
```json
{
  "name":"fasttopup-backend",
  "version":"1.0.0",
  "main":"server.js",
  "scripts":{ "start":"node server.js" },
  "dependencies":{
    "express":"^4.18.2",
    "better-sqlite3":"^8.0.0",
    "body-parser":"^1.20.2",
    "cors":"^2.8.5",
    "bcrypt":"^5.1.0",
    "jsonwebtoken":"^9.0.0",
    "node-fetch":"^2.6.7",
    "uuid":"^9.0.0",
    "dotenv":"^16.0.3",
    "axios":"^1.6.2"
  }
}
```

---

## E. Backend migration — `backend/migrations/001_init.sql`
```sql
CREATE TABLE IF NOT EXISTS admin (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE,
  password TEXT
);

CREATE TABLE IF NOT EXISTS transactions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id TEXT UNIQUE,
  player_id TEXT,
  server_id TEXT,
  game TEXT,
  product TEXT,
  price INTEGER,
  payment_method TEXT,
  status TEXT,
  supplier_response TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

---

## F. Backend server — `backend/server.js`
```js
require('dotenv').config();
const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');
const Database = require('better-sqlite3');
const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');
const axios = require('axios');
const { v4: uuidv4 } = require('uuid');

const db = new Database('./database.db');
// run migrations
const fs = require('fs');
const initSql = fs.readFileSync('./migrations/001_init.sql','utf8');
initSql.split(';').forEach(s=>{ if(s.trim()) db.prepare(s).run(); });

const app = express();
app.use(cors());
app.use(bodyParser.json());
app.use(express.static('../frontend'));

const JWT_SECRET = process.env.JWT_SECRET || 'devsecret';

// create default admin
const cnt = db.prepare('SELECT COUNT(*) as c FROM admin').get().c;
if(cnt===0){ const pw = bcrypt.hashSync('admin123',10); db.prepare('INSERT INTO admin(username,password) VALUES(?,?)').run('admin',pw); console.log('Default admin created: admin / admin123'); }

// PUBLIC: check-id (mock or supplier)
app.post('/api/check-id', async (req,res)=>{
  const { playerId, serverId, game } = req.body;
  if(!playerId) return res.json({ok:false});
  // In prod: call supplier's endpoint. Here we return ok for demo.
  return res.json({ok:true, player:{id:playerId, name:'Player'+playerId}});
});

// PUBLIC: create order
app.post('/api/order', async (req,res)=>{
  const { playerId, serverId, game, productCode, productLabel, price, payment } = req.body;
  if(!playerId||!productCode) return res.json({ok:false,error:'missing fields'});
  const orderId = 'FT'+Date.now();
  db.prepare('INSERT INTO transactions(order_id,player_id,server_id,game,product,price,payment_method,status) VALUES(?,?,?,?,?,?,?,?)')
    .run(orderId,playerId,serverId,game,productLabel,price,payment,'pending');

  // create payment (placeholder): integrate with Xendit/Midtrans here
  let payUrl = null;
  if(process.env.PAYMENT_PROVIDER==='xendit' && process.env.XENDIT_KEY){
    // implement real Xendit invoice creation here
    payUrl = `https://checkout.xendit.co/mock/${orderId}`;
  } else {
    payUrl = `/pay/mock/${orderId}`;
  }

  // push to supplier in background (simulated)
  setTimeout(async ()=>{
    try{
      // Example Digiflazz-like payload
      const payload = { username: process.env.SUPPLIER_USER || 'demo', buyer_sku_code: productCode, customer_no: playerId, ref_id: orderId };
      // If SUPPLIER_API set, call it, else simulate
      if(process.env.SUPPLIER_API){
        const r = await axios.post(process.env.SUPPLIER_API + '/transaction', payload, { headers: { 'Authorization': process.env.SUPPLIER_KEY || '' } });
        db.prepare('UPDATE transactions SET status=?, supplier_response=? WHERE order_id=?').run('processing', JSON.stringify(r.data), orderId);
      } else {
        db.prepare('UPDATE transactions SET status=?, supplier_response=? WHERE order_id=?').run('success', JSON.stringify({sim:'ok'}), orderId);
      }
    } catch(e){ db.prepare('UPDATE transactions SET status=?, supplier_response=? WHERE order_id=?').run('error', JSON.stringify({err:e.message}), orderId); }
  }, 2000);

  return res.json({ok:true, orderId, payUrl});
});

// PUBLIC: recent
app.get('/api/recent', (req,res)=>{
  const rows = db.prepare('SELECT order_id,player_id,game,product,price,status,created_at FROM transactions ORDER BY created_at DESC LIMIT 10').all();
  res.json({rows});
});

// ADMIN login
app.post('/api/admin/login', async (req,res)=>{
  const { username, password } = req.body;
  const row = db.prepare('SELECT * FROM admin WHERE username=?').get(username);
  if(!row) return res.json({ok:false});
  const match = await bcrypt.compare(password,row.password);
  if(!match) return res.json({ok:false});
  const token = jwt.sign({id:row.id,username:row.username}, JWT_SECRET, { expiresIn:'8h' });
  res.json({ok:true,token});
});

// ADMIN: list transactions (auth)
function auth(req,res,next){ const h=req.headers.authorization; if(!h) return res.status(401).json({ok:false}); try{ const t=h.split(' ')[1]; const p=jwt.verify(t,JWT_SECRET); req.user=p; next(); }catch(e){ return res.status(401).json({ok:false}) }}
app.get('/api/admin/transactions', auth, (req,res)=>{ const rows = db.prepare('SELECT * FROM transactions ORDER BY created_at DESC LIMIT 200').all(); res.json({ok:true,rows}); });

// Health
app.get('/api/health',(req,res)=>res.json({ok:true}));

const PORT = process.env.PORT || 3000;
app.listen(PORT, ()=> console.log('FastTopUp backend running on',PORT));
```

---

## G. Dockerfile & docker-compose
**backend/Dockerfile**
```Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm install --production
COPY . .
EXPOSE 3000
CMD ["node","server.js"]
```

**docker-compose.yml** (root)
```yaml
version: '3.8'
services:
  web:
    build: ./backend
    ports:
      - "3000:3000"
    volumes:
      - ./backend:/app
    environment:
      - JWT_SECRET=isi_rahasia_kamu
      - PAYMENT_PROVIDER=mock
      - SUPPLIER_API=
      - SUPPLIER_KEY=
```

---

## H. Payment gateway integration (Xendit / Midtrans) — ringkasan kode
- Untuk Xendit: panggil Create Invoice API, simpan `invoice_url` di transaksi, kirim ke frontend. Tambahkan webhook `/api/payment/webhook` untuk menerima paid status.
- Untuk Midtrans: buat Snap token di server, kirim ke frontend, konfirmasi via webhook.

> File contoh integrasi ada di `backend/server.js` sebagai placeholder. Jika kamu berikan API key Xendit/Midtrans, aku bisa masukkan contoh live call dan webhook handler.

---

## I. Branding & Logo
- `frontend/assets/logo.png` — ganti dengan logo kamu (format PNG 256x256).
- Warna utama sudah di CSS: `--accent: #4a6cf7`. Kalau mau tema ML/FF/Valorant beri tahu warna dan aku ganti.

---

## J. README.md (ringkas)
```md
# FastTopUp
Project website top-up siap jual.

## Setup local
1. Backend
   - cd backend
   - npm install
   - cp .env.example .env (edit nilai)
   - npm start
2. Frontend
   - buka frontend/index.html (jika di domain berbeda set API_BASE)

## Docker
- docker compose up -d

## Notes
- Isi SUPPLIER_API dan SUPPLIER_KEY jika sudah daftar supplier.
- Isi XENDIT_KEY jika mau integrasi Xendit.
```

---

## K. LICENSE
Gunakan MIT atau pilih sendiri.

---

Jika kamu mau, langkah berikut yang bisa aku lakukan sekarang (pilih 1):
1. **Generate ZIP** dari semua file sehingga kamu bisa download (aku akan buat file di canvas dan sediakan link jika platform mendukung). 
2. **Masukkan contoh panggilan Xendit/midtrans** — kamu tinggal masukkan API key.
3. **Ubah tema warna & buat logo** (aku desain 3 logo konsep untuk dipilih).
4. **Deploy ke server demo** (kalau kamu beri akses atau menggunakan layanan deploy publik).

Pilih yang mana, aku kerjakan sekarang.
